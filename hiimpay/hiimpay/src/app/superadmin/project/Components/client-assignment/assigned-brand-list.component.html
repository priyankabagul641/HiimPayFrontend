<section class="assigned-shell">
  <div class="assigned-root">
    <div class="hero">
      <div>
        <p class="eyebrow">Reward History</p>
        <h2>Assigned Rewards</h2>
        <p class="sub">Track all coupon and amount assignments for this client in one place.</p>
      </div>
      <div class="metrics">
        <div class="metric">
          <span class="metric-label">Coupons</span>
          <span class="metric-value">{{ couponRows.length }}</span>
        </div>
        <div class="metric">
          <span class="metric-label">Amounts</span>
          <span class="metric-value">{{ amountRows.length }}</span>
        </div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab" [class.active]="activeTab==='coupons'" (click)="activeTab='coupons'">Assigned Coupons</button>
      <button class="tab" [class.active]="activeTab==='amounts'" (click)="activeTab='amounts'">Assigned Amounts</button>
    </div>

    <div class="table-card" *ngIf="activeTab==='coupons' && couponRows.length > 0; else noCouponData">
      <div class="table-scroll">
        <table class="assignment-table">
          <colgroup>
            <col class="col-date">
            <col class="col-brand">
            <col class="col-coupons">
            <col class="col-employees">
            <col class="col-action">
          </colgroup>
          <thead>
            <tr>
              <th class="text-left">Assigned Date</th>
              <th class="text-left">Brand Name</th>
              <th class="text-center">Coupons</th>
              <th class="text-center">Employees</th>
              <th class="text-center">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of couponRows">
              <td class="text-left">{{ item.assignedDate | date:'medium' }}</td>
              <td class="text-left">{{ item.brandName }}</td>
              <td class="text-center">{{ item.coupons?.length }}</td>
              <td class="text-center">{{ item.employees?.length }}</td>
              <td class="text-center">
                <button
                  type="button"
                  class="btn btn-sm action-btn icon-action-btn"
                  (click)="downloadAssignmentReport(item, 'coupon')"
                  aria-label="Download coupon assignment report"
                  title="Download report">
                  <i class="fa fa-download" aria-hidden="true"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="table-card" *ngIf="activeTab==='amounts' && amountRows.length > 0; else noAmountData">
      <div class="table-scroll">
        <table class="assignment-table amount-table">
          <thead>
            <tr>
              <th class="text-left">Assigned Date</th>
              <th class="text-left">Mode</th>
              <th class="text-center">Amount</th>
              <th class="text-center">Employees</th>
              <th class="text-left">File</th>
              <th class="text-center">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of amountRows">
              <td class="text-left">{{ item.assignedDate | date:'medium' }}</td>
              <td class="text-left">{{ item.source }}</td>
              <td class="text-center">{{ item.amount ? ('Rs ' + item.amount) : '-' }}</td>
              <td class="text-center">{{ item.employeeCount ?? '-' }}</td>
              <td class="text-left">{{ item.fileName }}</td>
              <td class="text-center">
                <button
                  type="button"
                  class="btn btn-sm action-btn icon-action-btn"
                  (click)="downloadAssignmentReport(item, 'amount')"
                  aria-label="Download amount assignment report"
                  title="Download report">
                  <i class="fa fa-download" aria-hidden="true"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <ng-template #noCouponData>
      <div class="unavailability" *ngIf="activeTab==='coupons'">No coupon assignments found.</div>
    </ng-template>

    <ng-template #noAmountData>
      <div class="unavailability" *ngIf="activeTab==='amounts'">No amount assignments found.</div>
    </ng-template>
  </div>
</section>
