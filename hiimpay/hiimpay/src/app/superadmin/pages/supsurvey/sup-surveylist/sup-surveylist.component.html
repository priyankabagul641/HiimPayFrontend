<section class="coupon-shell">
  <div class="coupon-header">
    <h2>Coupon Dashboard</h2>
    <button type="button" class="create-btn" (click)="openCreateCoupon()">
      <mat-icon>add</mat-icon>
      <span>Create Coupon</span>
    </button>
  </div>

  <div class="toolbar-card">
    <div class="toolbar-grid">
      <input
        type="text"
        class="search-input"
        placeholder="Search by product, brand, provider, sku..."
        [(ngModel)]="searchTerm"
        (ngModelChange)="onFiltersChanged()">

      <select
        class="filter-select"
        [(ngModel)]="statusFilter"
        (ngModelChange)="onFiltersChanged()">
        <option value="all">All Status</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
      </select>
    </div>
  </div>

  <div class="loader-wrap" *ngIf="isLoading">
    <i class="fa fa-spinner fa-spin loader-icon"></i>
  </div>

  <ng-container *ngIf="!isLoading">
    <div class="table-card" *ngIf="filteredSurveyList && filteredSurveyList.length > 0; else emptyState">
      <div class="desktop-table">
        <table class="coupon-table">
          <thead>
            <tr>
              <th class="col-sku text-left">SKU</th>
              <th class="col-provider text-left">Provider</th>
              <th class="col-product text-left">Product</th>
              <th class="col-brand text-left">Brand</th>
              <th class="col-category text-left">Category</th>
              <th class="col-value text-center">Value</th>
              <th class="col-discount text-center">Discount %</th>
              <th class="col-expiry text-center">Expiry</th>
              <th class="col-status text-center">Status</th>
              <th class="col-action text-center">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let item of filteredSurveyList | paginate: { itemsPerPage: itemPerPage, currentPage: page, totalItems: totalItems }; let i = index"
              [class.alt-row]="i % 2 === 1">
              <td class="text-left truncate-cell" [title]="item?.coupon_sku || '-'">{{ item?.coupon_sku || '-' }}</td>
              <td class="text-left truncate-cell" [title]="item?.provider_name || '-'">{{ item?.provider_name || '-' }}</td>
              <td class="text-left truncate-cell" [title]="item?.product_name || '-'">{{ item?.product_name || '-' }}</td>
              <td class="text-left truncate-cell" [title]="item?.brand_name || '-'">{{ item?.brand_name || '-' }}</td>
              <td class="text-left truncate-cell" [title]="item?.category || '-'">{{ item?.category || '-' }}</td>
              <td class="text-center nowrap">{{ (item?.min_value != null ? item.min_value : '-') + ' / ' + (item?.max_value != null ? item.max_value : '-') }}</td>
              <td class="text-center nowrap">{{ item?.discount_percent != null ? item.discount_percent : '-' }}</td>
              <td class="text-center nowrap">{{ item?.expiry_date || '-' }}</td>
              <td class="text-center">
                <span class="status-badge" [class.badge-active]="item?.is_active" [class.badge-inactive]="!item?.is_active">
                  {{ item?.is_active ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td class="text-center">
                <div class="action-group">
                  <button type="button" class="icon-btn view-btn" title="View" (click)="openViewCoupon(item)">
                    <mat-icon>visibility</mat-icon>
                  </button>
                  <button type="button" class="icon-btn delete-btn" title="Delete" (click)="deleteSurvey(item)">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="mobile-cards">
        <article
          class="coupon-card"
          *ngFor="let item of filteredSurveyList | paginate: { itemsPerPage: itemPerPage, currentPage: page, totalItems: totalItems }">
          <h4 [title]="item?.product_name || '-'">{{ item?.product_name || '-' }}</h4>
          <p><strong>SKU:</strong> <span [title]="item?.coupon_sku || '-'">{{ item?.coupon_sku || '-' }}</span></p>
          <p><strong>Brand:</strong> {{ item?.brand_name || '-' }}</p>
          <p><strong>Provider:</strong> {{ item?.provider_name || '-' }}</p>
          <p><strong>Value:</strong> {{ (item?.min_value != null ? item.min_value : '-') + ' / ' + (item?.max_value != null ? item.max_value : '-') }}</p>
          <p><strong>Expiry:</strong> {{ item?.expiry_date || '-' }}</p>
          <p>
            <strong>Status:</strong>
            <span class="status-badge" [class.badge-active]="item?.is_active" [class.badge-inactive]="!item?.is_active">
              {{ item?.is_active ? 'Active' : 'Inactive' }}
            </span>
          </p>
          <div class="mobile-actions">
            <button type="button" class="icon-btn view-btn" title="View" (click)="openViewCoupon(item)">
              <mat-icon>visibility</mat-icon>
            </button>
            <button type="button" class="icon-btn delete-btn" title="Delete" (click)="deleteSurvey(item)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </article>
      </div>

      <div class="pagination-wrap">
        <pagination-controls (pageChange)="pageChangeEvent($event)" [maxSize]="5"></pagination-controls>
      </div>
    </div>

    <ng-template #emptyState>
      <div class="empty-state">
        <h4>No coupons found</h4>
        <p>Try changing the search text or status filter.</p>
      </div>
    </ng-template>
  </ng-container>
</section>
